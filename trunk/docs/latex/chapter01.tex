% chapter01.tex

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                           %
 %    YABBY documentation                                                    %
 %    Copyright (C) 2007 Vladimir Likic                                      %
 %                                                                           %
 %    The files in this directory provided under the Creative Commons        %
 %    Attribution-NonCommercial-NoDerivs 2.1 Australia license               %
 %    http://creativecommons.org/licenses/by-nc-nd/2.1/au/                   %
 %    See the file license.txt                                               %
 %                                                                           %
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setcounter{section}{0}

\chapter{Introduction}

\section{What is Yabby}

- Introduction
- Motivation
- Features
- License

Yabby is released as open source, under the GNU Public License
version 2.

\section{Installation}

\subsection{Checking Perl}

\index{installation}
\index{Perl}
\index{system requirements}

Yabby has been developed with Perl version 5.X, a freely available
general purpose scripting language. Perl stands for "Practical
Extraction and Report Language" and is particularly well suited for
the manipulation of data stored in plain text files. This seems
all too often to be required in bioinformatics applications.

Before attempting the installation, it is highly recommended to
check if the Perl interpreter is present your computer system.
For example, on a Linux system,

\begin{verbatim}
$ perl -v

This is perl, v5.8.5 built for i386-linux-thread-multi

Copyright 1987-2004, Larry Wall

Perl may be copied only under the terms of either the Artistic License or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using `man perl' or `perldoc perl'.  If you have access to the
Internet, point your browser at http://www.perl.com/, the Perl Home Page.
\end{verbatim}

Perl 5 and later is required for Yabby.  The next step is to find where
exactly is the Perl interpreter located, as this information will be
required for Yabby installation:

\begin{verbatim}
$ which perl
/usr/local/bin/perl
\end{verbatim}

\subsection{Downloading Yabby}

Yabby source code can be browsed from the Google Code servers, at
the URL: http://code.google.com/p/yabby/. Under the
section "Source" one can find the instructions for downloading the
source code. The same page provides the link under "This project's
Subversion repository can be viewed in your web browser" which allows
one to browse the source code on the server without actually
downloading it.

Google servers maintain the source code by the program called 'subversion'
(an open-source version control system).  To download the source code
one needs to use the subversion client program called 'svn'.  The 'svn'
client exists for all mainstream operating systems\footnote{For example,
on Linux CentOS 4 the RPM package 'subversion-1.3.2-1.rhel4.i386.rpm'
provides the subversion client 'svn'.}, for more information see
http://subversion.tigris.org/.  The book about subversion is freely
available on-line at http://svnbook.red-bean.com/. Subversion has
extensive functionality however only the very basic functionality
is needed to download Yabby.  Assuming that the computer is connected
to the internet, the following command will download the latest Yabby 
source code in the current directory:

\begin{verbatim}
$ svn checkout http://yabby.googlecode.com/svn/trunk/ yabby
A    yabby/yabby.pl
A    yabby/LICENSE
A    yabby/lib
A    yabby/lib/blast.pl
A    yabby/lib/hmm_score2seq.pl
A    yabby/lib/seq_strip.pl
A    yabby/lib/seq_comment.pl
A    yabby/lib/hmm_score.pl
A    yabby/lib/blastg.pl
A    yabby/lib/motif_cmp.pl
A    yabby/lib/seq_unique.pl
A    yabby/lib/yabby_seq.pm
....further output deleted....
\end{verbatim}

\subsection{Yabby installation}

Yabby installation requires that the file 'yabby/lib/yabby.pl' is
modified to to set the path to the Perl language interpreter,
and to Yabby libraries.

If Yabby code was downloaded in the directory /home/jake/ (and
therefore the script 'yabby.pl' is in /home/jake/yabby/), to set
the path to Yabby libraries the following two lines need to be
set: 

\begin{verbatim}
use lib "/home/jake/yabby/lib";
$LIB_DIR = "/home/jake/yabby/lib";
\end{verbatim}

The path to the Perl interpreter is set in the first line of the
file 'yabby.pl':

\begin{verbatim}
#!/usr/bin/perl
\end{verbatim}

The script yabby.pl needs to have executable permissions:

\begin{verbatim}
$ chmod +x yabby.pl
\end{verbatim}

If this is all set, running the script 'yabby.pl' will start Yabby:

\begin{verbatim}
$ yabby.pl

 - YABBY version 0.1 - 
   Copyright (c) 2004-7 Vladimir Likic
 [ 35 command(s) ready ]

yabby>
\end{verbatim}

It is often useful to create a symbolic link in a directory which
is included the PATH variable, such as /usr/local/bin or ~/bin:

\begin{verbatim}
ln -s /home/jake/yabby/yabby.pl /home/jake/bin/yabby
\end{verbatim}

This would allow Yabby to be run from any directory, simply by
typing 'yabby'.

\section{Running Yabby}

\subsection{An interactive session}

Yabby can be run interactively or from the command script. To
start an Yabby interactive session one needs to start the Yabby
interface from the Unix shell. Here is the simplest Yabby session:

\begin{verbatim}
$ yabby

 - YABBY version 0.1 - 
   Copyright (c) 2004-7 Vladimir Likic
 [ 35 command(s) ready ]

yabby> quit

 bye-bye
\end{verbatim}

\subsection{Yabby command scripts}

In order to run Yabby from the command script, the command file
needs to be prepared first. Such a file lists Yabby commands
one per line, with optional blank lines (lines which start with
the \% character are ignored). For example, the following input
file, named test.yab,

\begin{verbatim}
% test.yab -- test input script

seq_load cad3.seq cad3
seq_info -l cad3
\end{verbatim}

could be run with the Unix shell input redirection:

\begin{verbatim}
$ yabby < test.yab

 - YABBY version 0.1 - 
   Copyright (c) 2004-7 Vladimir Likic
 [ 35 command(s) ready ]

yabby> % test.yab -- test input script
yabby> yabby> 
 Reading the file 'cad3.seq' ..
 3 sequence(s) found.

yabby> 
 'cad3' contains 3 sequence(s)
  1 -> Q53650_STAAU, 192 residues
  2 -> Q97PJ0_STRPN, 193 residues
  3 -> P95773_STALU, 192 residues

yabby> yabby> 
 bye-bye
\end{verbatim}

When run from the command script the actual commands are not
echoed back, only the command's screen output as well as the
comments.

\subsection{Executing Unix commands}

\index{unix commands}

Any command which is not recognized by Yabby is assumed to be
an Unix command, and Yabby will attempt to execute it. Consider
the following example:

\begin{verbatim}
yabby> ls
1BT0.pdb  cox1.seq     LmjFmockup.pep  needle.out
cad3.seq  dna.seq      m2.blocks       README
cad.seq   hmmpfam.out  meme.out        test.yab
yabby> l

 [ UNIX command 'l' failed ]
\end{verbatim}

Because there is no Yabby command {\tt ls}, it was assumed to
be a system command and executed.  The output was printed on
the screen, listing the files and directories in the directory
where Yabby was started.

Subsequently, the command {\tt l} was given but failed because
there is no such Yabby or Unix command. If {\tt l} was an alias
to something (say {\tt ls -CF}) the command would fail regardless,
because Yabby does not know about shell aliases.

There are no inherent limitations to which Unix commands can be
executed within Yabby. It is possible to run a text editor, such
as "vi" (and then simply resume the Yabby session after exiting
the editor), or even start programs with GUI such as "gnuplot",
or a Unix terminal window.

A subtle but important point is that in Yabby Unix commands are
not executed through the Unix shell.  The consequence of this
is that the (sometimes important) functions provided the the
Unix shell, such as file globing, are not available. For example:

\begin{verbatim}
yabby> ls *
ls: *: No such file or directory

 [ UNIX command 'ls *' failed ]
\end{verbatim}

A handy trick which allows one to go about Unix business is
to temporarily suspend Yabby. This is actually a feature provided
by some unix shells (in combination with the system's terminal driver),
and has little to do with Yabby. In short, typing Ctrl-Z within
Yabby will suspend the current Yabby session, and return user
to the Unix shell. Issuing the command "fg" to the same shell
will return the suspended Yabby session:

\begin{verbatim}
yabby> [Cntrl-Z]
[1]+  Stopped                 yabby
$ ls -CF
1BT0.pdb  cox1.seq     LmjFmockup.pep  needle.out
cad3.seq  dna.seq      m2.blocks       README
cad.seq   hmmpfam.out  meme.out        test.yab
$ fg

yabby>
\end{verbatim}

Ctrl-Z was typed on the first line, which was not echoed back. Note
that the second command prompt (starting with the {\tt \$} character)
is the Unix shell prompt, and typing "fg" had returned user to
the suspended Yabby session.

\section{Understanding how Yabby works}

To understand how Yabby works it is important to understand the
relationhips between three directories: the working directory
where the Yabby session has been started, the Yabby library (this
is the lib/ subdirectory in the the Yabby installation directory),
and the workspace directory.

The workspace directory is created automatically in the working
directory when the Yabby session is initialized. The workspace
directory is called .yabby, and it contains all the yabby objects
created within the session. Upon graceful exit from the Yabby
shell, the workspace directory is destroyed together with its
content.  The relationship between the working directory,
workspace, and Yabby library is shown in Figure \ref{fig:session}.

\begin{figure}
\centering
\includegraphics[height=6.0cm]{pics/yabby-session.eps}
\caption{A schematic showing the relationship between the working
directory, Yabby installation directory, and the workspace. In
this example the Yabby session was started in the user's home
directory (/home/jake), and this has created the workspace directory
(/home/jake/.yabby). The execution of the command seq\_load from
the Yabby shell has executed the script seq\_load.pl from the Yabby
library, and has created the tom20.seq object. This object corresponds
to the file tom20.seq which is created in the workspace directory.}
\label{fig:session}
\end{figure}

Consider in more detail what happens when the sequences were read
from the file 'tom20.txt' to create a sequence object in the
workspace, as shown in Figure \ref{fig:session}:

\begin{verbatim}
1  $ yabby
2 
3   - YABBY version 0.1 -
4     Copyright (c) 2004-7 Vladimir Likic
5   [ 35 command(s) ready ]
6 
7  yabby> seq_load tom20.txt tom20
8  
9   Reading the file 'tom20.txt' ..
10  3 sequence(s) found.
11 
12 yabby> what
13 
14     object(s)      type
15   ------------------------------
16     tom20          seq   
17 
18 yabby> print tom20.seq
19
20 >A.thaliana2 [ A.thaliana2 ]
21 MEFSTADFERFIMFEHARKNSEAQYKNDPLDSENLLKWGGALLELSQFQPIPEAKLMLND
22 AISKLEEALTINPGKHQALWCIANAYTAHAFYVHDPEEAKEHFDKATEYFQRAENEDPGN
23 DTYRKSLDSSLKAPELHMQFMNQGMGQQILGGGGGGGGGGMASSNVSQSSKKKKRNTEFT
24 YDVCGWIILACGIVAWVGMAKSLGPPPPAR
25 >O.sativa [ O.sativa ]
26 MDMGAMSDPERMFFFDLACQNAKVTYEQNPHDADNLARWGGALLELSQMRNGPESLKCLE
27 DAESKLEEALKIDPMKADALWCLGNAQTSHGFFTSDTVKANEFFEKATQCFQKAVDVEPA
28 NDLYRKSLDLSSKAPELHMEIHRQMASQASQAASSTSNTRQSRKKKKDSDFWYDVFGWVV
29 LGVGMVVWVGLAKSNAPPQAPR
30 >L.esculentum [ L.esculentum ]
31 MDMQSDFDRLLFFEHARKTAETTYATDPLDAENLTRWAGALLELSQFQSVSESKKMISDA
32 ISKLEEALEVNPQKHDAIWCLGNAYTSHGFLNPDEDEAKIFFDKAAQCFQQAVDADPENE
33 LYQKSFEVSSKTSELHAQIHKQGPLQQAMGPGPSTTTSSTKGAKKKSSDLKYDVFGWVIL
34 AVGLVAWIGFAKSNMPXPAHPLPR
\end{verbatim}

In line 1 the Yabby was started from the Unix shell command line.
During the initalization process the workspace directory .yabby
was silently created.

The command shown on line 7:

\begin{verbatim}
seq_load tom20.txt tom20
\end{verbatim}

will read the sequence from the file 'tom20.txt', and save the sequences
under the name 'tom20'. The command 'what' shown on line 12 allows one
to inspect the content of the workspace. It shows that the workspace
contains the object named 'tom20' of the type 'seq'. The command 'print'
on the line 18 printed the object 'tom20' on the terminal screen.

The command 'seq\_load' has executed the script 'seq\_load.pl'
located in the Yabby library. This command reads the FASTA sequence
file and converts it into a Yabby object of the type 'seq'. The
command 'print' has executed the script 'print.pl' from the Yabby
library. The scripts 'seq\_load.pl' and 'print.pl' are completely
independent. How was the data (i.e. the newly created 'seq' object)
transferred from the script 'seq\_load.pl' to the 'print' command?

This was achieved by the use of the workspace directory. When Yabby
was started (line 1) the workspace directory .yabby/ was silently
created in the current working directory. The newly created object
'tom20' (the result of the command 'seq\_load') was stored in the
file in the workspace directory. On the line 18, the command 'print'
was requested to print the object 'tom20' of the type 'seq'
(abbreviated as 'tom20.seq'). The command 'print' has first attempted
to find the object 'tom20.seq' in the workspace. This was successful,
and the object was first loaded from the workspace directory, and
then printed on the terminal screen.

Consider printing a non-existent sequence object:

\begin{verbatim}
yabby> print tom99.seq

 _print_seq:: missing requirement: 'tom99.seq'

 print:: ERROR: system script '_print_seq' failed
 [ error occurred in the subroutine call() ]
 [ command 'print' failed ]
\end{verbatim}

The message above shows that 'tom99.seq' is not in the workspace.
Printing of the sequence objects is handled by the script '\_print\_seq.pl',
which is invoked by the command script 'print.pl'.

Consider printing an object of a non-exiting type:

\begin{verbatim}
yabby> print tom20.ttt

 print:: ERROR: printing the property 'ttt' not yet implemented
 [ command 'print' failed ]
\end{verbatim}

This message comes from the command script 'print.pl'. Since this
command script needs to decide which system script to call for
printing, it first must determine if the printing of the requested
object type has been implemented.


